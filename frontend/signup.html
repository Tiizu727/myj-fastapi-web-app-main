<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>æ–°è¦ç™»éŒ² - ã ã‚Œã§ã‚‚è‡ªä½œPCãƒŠãƒ“</title>
  <!-- cssãƒ•ã‚¡ã‚¤ãƒ«ã‚’import -->
  <link rel="stylesheet" href="/css/general.css">

  <!-- jsãƒ•ã‚¡ã‚¤ãƒ«ã‚’import -->
  <script type="text/javascript" src="/js/general.js"></script>
  <script type="text/javascript" src="/js/api.js"></script>
</head>

<body class="auth-body">
  <div class="auth-container">
    <div class="auth-header">
      <div class="auth-logo">
        <img src="/img/logo.png" alt="Logo" class="logo-image" />
        <h1 class="auth-title">ã ã‚Œã§ã‚‚è‡ªä½œPCãƒŠãƒ“</h1>
      </div>
      <p class="auth-subtitle">æ–°ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
    </div>

    <div class="auth-form">
      <div class="form-group">
        <div id="megs" class="error-message">&nbsp;</div>
      </div>
      
      <div class="form-group">
        <label for="nickname" class="form-label">
          <span class="label-icon">ğŸ‘¤</span>
          ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ 
        </label>
        <input type="text" id="nickname" name="nickname" class="form-input" placeholder="è¡¨ç¤ºåã‚’å…¥åŠ›" required>
      </div>

      <div class="form-group">
        <label for="email" class="form-label">
          <span class="label-icon">ğŸ“§</span>
          ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
        </label>
        <input type="email" id="email" name="email" class="form-input" placeholder="example@email.com" required>
      </div>

      <div class="form-group">
        <label for="password" class="form-label">
          <span class="label-icon">ğŸ”’</span>
          ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        </label>
        <input type="password" id="password" name="password" class="form-input" placeholder="å®‰å…¨ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š" required>
      </div>

      <div class="form-actions">
        <button onclick="register()" class="auth-primary-button">
          <span class="button-icon">âœ¨</span>
          æ–°è¦ç™»éŒ²
        </button>
        
        <div class="auth-divider">
          <span>ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã™ã‹ï¼Ÿ</span>
        </div>
        
        <a href="/login.html" class="auth-secondary-button">
          <span class="button-icon">ğŸ”‘</span>
          ãƒ­ã‚°ã‚¤ãƒ³
        </a>
      </div>

      <div class="auth-footer">
        <a href="/index.html" class="back-link">
          <span class="link-icon">ğŸ </span>
          ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
        </a>
      </div>
    </div>
  </div>

</body>

<script>
  if (checkLogin()) {
    location.href = "/index.html"
  }

  const register = () => {
    // ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
    // .trim()ã§å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
    const nickname = document.getElementById('nickname').value.trim()
    const email = document.getElementById('email').value.trim()
    const password = document.getElementById('password').value.trim()

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è¦ç´ ã‚’å–å¾—
    const megsBox = document.getElementById('megs')

    // å…¨ã¦ã®é …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    if (nickname === '' || email === '' || password === '') {
      megsBox.innerText = 'å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
      megsBox.style.display = 'block'
      return
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®é•·ã•ãƒã‚§ãƒƒã‚¯
    if (password.length < 6) {
      megsBox.innerText = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„'
      megsBox.style.display = 'block'
      return
    }

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è¡¨ç¤º
    const registerButton = document.querySelector('.auth-primary-button')
    const originalText = registerButton.innerHTML
    registerButton.innerHTML = '<span class="button-icon">â³</span>ç™»éŒ²ä¸­...'
    registerButton.disabled = true

    // APIç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹
    const data = {
      email: email,
      nickname: nickname,
      password: password
    }

    // APIæ“ä½œã‚’å‘¼ã³å‡ºã™
    signUpApi(data)
      .then((res) => {
        megsBox.innerHTML = '<span style="color: #00b894;">âœ… æ–°è¦ç™»éŒ²ã«æˆåŠŸã—ã¾ã—ãŸï¼</span><br><a href="/login.html" style="color: #0984e3; text-decoration: underline;">ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ç§»å‹•</a>'
        megsBox.style.display = 'block'
        
        // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('nickname').value = ''
        document.getElementById('email').value = ''
        document.getElementById('password').value = ''
        
        registerButton.innerHTML = originalText
        registerButton.disabled = false
      })
      .catch((error) => {
        megsBox.innerText = 'âŒ ' + error.message
        megsBox.style.display = 'block'
        registerButton.innerHTML = originalText
        registerButton.disabled = false
        throw error
      })
  }

  // Enterã‚­ãƒ¼ã§ç™»éŒ²
  document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      register()
    }
  })
</script>

</html>