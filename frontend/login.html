<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>ãƒ­ã‚°ã‚¤ãƒ³ - ã ã‚Œã§ã‚‚è‡ªä½œPCãƒŠãƒ“</title>
  <!-- cssãƒ•ã‚¡ã‚¤ãƒ«ã‚’import -->
  <link rel="stylesheet" href="/css/general.css">

  <!-- jsãƒ•ã‚¡ã‚¤ãƒ«ã‚’import -->
  <script type="text/javascript" src="/js/general.js"></script>
  <script type="text/javascript" src="/js/api.js"></script>
</head>

<body class="auth-body">
  <div class="auth-container">
    <div class="auth-header">
      <div class="auth-logo">
        <img src="/img/logo.png" alt="Logo" class="logo-image" />
        <h1 class="auth-title">ã ã‚Œã§ã‚‚è‡ªä½œPCãƒŠãƒ“</h1>
      </div>
      <p class="auth-subtitle">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p>
    </div>

    <div class="auth-form">
      <div class="form-group">
        <div id="megs" class="error-message">&nbsp;</div>
      </div>
      
      <div class="form-group">
        <label for="email" class="form-label">
          <span class="label-icon">ğŸ“§</span>
          ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
        </label>
        <input type="email" id="email" name="email" class="form-input" placeholder="example@email.com" required>
      </div>

      <div class="form-group">
        <label for="password" class="form-label">
          <span class="label-icon">ğŸ”’</span>
          ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        </label>
        <input type="password" id="password" name="password" class="form-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
      </div>

      <div class="form-actions">
        <button onclick="login()" class="auth-primary-button">
          <span class="button-icon">ğŸ”‘</span>
          ãƒ­ã‚°ã‚¤ãƒ³
        </button>
        
        <div class="auth-divider">
          <span>ã¾ãŸã¯</span>
        </div>
        
        <a href="/signup.html" class="auth-secondary-button">
          <span class="button-icon">ğŸ‘¤</span>
          æ–°è¦ç™»éŒ²
        </a>
      </div>

      <div class="auth-footer">
        <a href="/index.html" class="back-link">
          <span class="link-icon">ğŸ </span>
          ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
        </a>
      </div>
    </div>
  </div>

</body>

<script>
  if (checkLogin()) {
    location.href = "/index.html"
  }

  const login = () => {
    // ãƒ•ã‚©ãƒ¼ãƒ ã®å€¤ã‚’å–å¾—
    // .trim()ã§å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
    const email = document.getElementById('email').value.trim()
    const password = document.getElementById('password').value

    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®è¦ç´ ã‚’å–å¾—
    const megsBox = document.getElementById('megs')

    // å…¨ã¦ã®é …ç›®ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
    if (email === '' || password === '') {
      megsBox.innerText = 'å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
      megsBox.style.display = 'block'
      return
    }

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è¡¨ç¤º
    const loginButton = document.querySelector('.auth-primary-button')
    const originalText = loginButton.innerHTML
    loginButton.innerHTML = '<span class="button-icon">â³</span>ãƒ­ã‚°ã‚¤ãƒ³ä¸­...'
    loginButton.disabled = true

    // APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
    loginApi(email, password)
      .then((data) => {
        megsBox.innerHTML = '<span style="color: #00b894;">âœ… ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸ</span>'
        megsBox.style.display = 'block'
        setTimeout(() => {
          // å‰ã®ãƒšãƒ¼ã‚¸ãŒsave-build.htmlã ã£ãŸå ´åˆã¯ãã¡ã‚‰ã«ã€ãã‚Œä»¥å¤–ã¯index.htmlã«ç§»å‹•
          const referrer = document.referrer
          if (referrer && referrer.includes('/save-build.html')) {
            location.href = '/save-build.html'
          } else {
            location.href = '/index.html'
          }
        }, 1000)
      })
      .catch((error) => {
        megsBox.innerText = 'âŒ ' + error.message
        megsBox.style.display = 'block'
        loginButton.innerHTML = originalText
        loginButton.disabled = false
        throw error
      })
  }

  // Enterã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
  document.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      login()
    }
  })
</script>

</html>